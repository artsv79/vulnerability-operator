package source

import (
	"os"

	libk8s "github.com/ckotzbauer/libk8soci/pkg/kubernetes"
)

type ScanItem interface {
	ImageId() string
	ScanInput() string
	Cleanup() error
}

type Source interface {
	Initialize()
	ValidateConfig() error
	LoadScanItems() []ScanItem
}

type Sbom struct {
	Sbom    string
	ImageID string
	File    string
}

func (s Sbom) ImageId() string {
	return s.ImageID
}

func (s Sbom) ScanInput() string {
	return "sbom:" + s.File
}

func (s Sbom) Cleanup() error {
	return os.Remove(s.File)
}

type Image struct {
	libk8s.KubeImage
}

func (s Image) ImageId() string {
	return s.Image.ImageID
}

func (s Image) ScanInput() string {
	return "docker-archive:/tmp/image.tar.gz"
}

func (s Image) Cleanup() error {
	return os.Remove("/tmp/image.tar.gz")
}
